<!DOCTYPE html>
<html lang="en-US">
<head>
	<!-- Primary Meta Tags -->
	<title>Water level monitor with ultrasonic measurement - Arduino / ESP8266 / ESP32 - IoT measurement using Sigfox</title>
	<meta name="description" content="Level meter built on the Arduino platform, ESP8266, ESP32. Measurement with ultrasonic sensor HC-SR04 / JSN-SR04T. Sending data via Ethernet, WiFi, Sigfox. Water level measurement in a well, sump.">

	<!-- Open Graph / Facebook -->
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://martinius96.github.io/hladinomer-studna-scripty/en/">
	<meta property="og:title" content="Water level monitor with ultrasonic measurement - Arduino / ESP8266 / ESP32 - IoT measurement using Sigfox">
	<meta property="og:description" content="Level meter built on the Arduino platform, ESP8266, ESP32. Measurement with ultrasonic sensor HC-SR04 / JSN-SR04T. Sending data via Ethernet, WiFi, Sigfox. Water level measurement in a well, sump.">
	<meta property="og:image" content="">

	<!-- Twitter -->
	<meta property="twitter:card" content="summary_large_image">
	<meta property="twitter:url" content="https://martinius96.github.io/hladinomer-studna-scripty/en/">
	<meta property="twitter:title" content="Water level monitor with ultrasonic measurement - Arduino / ESP8266 / ESP32 - IoT measurement using Sigfox">
	<meta property="twitter:description" content="Level meter built on the Arduino platform, ESP8266, ESP32. Measurement with ultrasonic sensor HC-SR04 / JSN-SR04T. Sending data via Ethernet, WiFi, Sigfox. Water level measurement in a well, sump.">
	<meta property="twitter:image" content="">
	
	<link rel="icon" type="image/png" href="https://martinius96.github.io/termostat-ethernet/favicon.png">
	<link rel="sitemap" type="application/xml" title="Sitemap" href="../sitemap.xml" />
	<meta name="google-site-verification" content="UwZZh2EXv3iWUAi_1Z0hLxVCz6ySJ4UdY_BPoLtejwo" />    	
	<meta property='fb:admins' content='100001242570317'>
    	<meta charset="utf-8">
    	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	<script type="text/javascript">
    		window.smartlook||(function(d) {
    			var o=smartlook=function(){ o.api.push(arguments)},h=d.getElementsByTagName('head')[0];
    			var c=d.createElement('script');o.api=new Array();c.async=true;c.type='text/javascript';
    			c.charset='utf-8';c.src='https://rec.smartlook.com/recorder.js';h.appendChild(c);
    		})(document);
    		smartlook('init', 'db50efe9fff280a17db52b82be221240cbbd3dbe');
	</script>    
</head>
<body>
	<div class="container">
  		<div class="row">
    			<div class="col-sm-12">
<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <ul class="nav navbar-nav">
      	<li class="active"><a href="index.html">Water Level monitor</a></li>
	<li><a href="zrazkomer.html">Rainfall monitor</a></li>
	<li><a href="zapojenie.html">Wiring</a></li>      
<li><a href="json_client.html">JSON Client</a></li>    
      	<li><a href="kontakt.html">Contact</a></li>
<a href="../index.html"><img src="https://www.flaticon.com/svg/static/icons/svg/299/299857.svg" alt="Slovak flag.png, 2,2kB" title="Slovakia" height="32" width="32"></a>
            <img src="https://i.imgur.com/YAi45JJ.png" alt="Arduino Core" title="Arduino Core" height="32" width="32">
            <img src="https://i.imgur.com/2pOgsYZ.png" alt="Espressif IoT Development framework (ESP-IDF)" title="Espressif IoT Development framework (ESP-IDF)" height="32" width="32">
            <img src="https://i.imgur.com/Lsk36Zb.png" alt="Sigfox IoT network supported" title="Sigfox IoT network supported" height="32" width="32">
    </ul>
  </div>
</nav>  
				<div class="alert alert-success">
					<strong>Source codes for Arduino, ESP8266, ESP32, NewPing Library: </strong><a href="https://github.com/martinius96/hladinomer-studna-scripty/">Github project repository</a>
				</div>	
				<div class="alert alert-success">
					<strong><font color="red">Try Water Level Monitor project for free with your hardware: </strong><a href="http://arduino.clanweb.eu/studna_s_prekladom/?lang=en">HERE</font></a>
				</div>	
				<div class="alert alert-info">
					<strong>From 4th June 2021 available implementation for ESP32 in framework ESP-IDF v4.2 (4.0 compatible)</strong>
				</div>
				<div class="alert alert-danger">
					<strong>For source codes of web interface or questions, contact author in ENGLISH language at: </strong>martinius96@gmail.com
				</div>
<center><h1>Water level monitor project</h1></center>
<span class="label label-default">Arduino</span>
<span class="label label-primary">Ethernet</span>
<span class="label label-success">Wiznet W5100 / W5500</span>
<span class="label label-info">ESP8266</span>
<span class="label label-warning">ESP32</span>
<span class="label label-danger">Ultrasonic</span>
<span class="label label-default">HC-SR04</span>
<span class="label label-primary">JSN-SR04T</span>
<span class="label label-info">Sigfox</span>				
<hr>
<center> 
	<h2>Supported microcontrollers for project Waterwell Level Monitor</h2>
</center>	
     <hr>				
<div class="row">
	<div class="col-sm-2"><center><img src="https://i.imgur.com/wtnzKqO.png" width="128px" height="128px" style="border-radius: 50%;" alt="Microcontroller Arduino UNO" title="Microcontroller Arduino UNO"><br><b>Arduino UNO</b></center></div>
	<div class="col-sm-2"><center><img src="https://i.imgur.com/XHC8DBe.png" width="128px" height="128px" style="border-radius: 50%;" alt="Microcontroller Arduino Nano" title="Microcontroller Arduino Nano"><br><b>Arduino Nano</b></center></div>
	<div class="col-sm-2"><center><img src="https://i.imgur.com/fPxr64q.png" width="128px" height="128px" style="border-radius: 50%;" alt="Microcontroller Arduino Mega 1280/2560" title="Microcontroller Arduino Mega 1280/2560"><br><b>Arduino Mega 1280/2560</b></center></div>
	<div class="col-sm-2"><center><img src="https://i.imgur.com/koSyFuW.png" width="128px" height="128px" style="border-radius: 50%;" alt="Microcontroller NodeMCU v2 / v3 Lolin - ESP8266-12E / ESP8266-12F" title="Microcontroller NodeMCU v2 / v3 Lolin - ESP8266-12E / ESP8266-12F"><br><b>NodeMCU (ESP8266)</b></center></div>
	<div class="col-sm-2"><center><img src="https://i.imgur.com/FV9xi6K.png" width="128px" height="128px" style="border-radius: 50%;" alt="Microcontroller Wemos D1 Mini - ESP8266-12E / ESP8266-12F" title="Microcontroller Wemos D1 Mini - ESP8266-12E / ESP8266-12F"><br><b>Wemos D1 Mini  (ESP8266)</b></center></div>
	<div class="col-sm-2"><center><img src="https://i.imgur.com/BczG03b.png" width="128px" height="128px" style="border-radius: 50%;" alt="Microcontroller ESP32 Devkit V1 - ESP-WROOM-32 / ESP32-S" title="Microcontroller ESP32 Devkit V1 - ESP-WROOM-32 / ESP32-S"><br><b>ESP32 DevKit</b></center></div>
</div>	
<hr>		
<center> 
	<h2>Ethernet and Sigfox transmission technology modules for Waterwell Level Monitor project</h2>
</center>
<hr>
<div class="row">
<div class="col-sm-2"><center><img src="https://i.imgur.com/aaS35X2.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ethernet shield Wiznet W5100" title="Ethernet shield Wiznet W5100"><br><b>Wiznet W5100</b></center></div>
<div class="col-sm-2"><center><img src="https://i.imgur.com/mz4dhRA.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ethernet module Wiznet W5500" title="Ethernet module Wiznet W5500"><br><b>Wiznet W5500</b></center></div>
<div class="col-sm-4"><center><img src="https://i.imgur.com/LhpZGxj.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ethernet module Wiznet USR-ES1" title="Ethernet module Wiznet USR-ES1"><br><b>Wiznet USR-ES1</b></center></div>
<div class="col-sm-2"><center><img src="https://i.imgur.com/yIZEKct.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ethernet module MicroChip ENC28J60" title="Ethernet module MicroChip ENC28J60"><br><b>MicroChip ENC28J60</b></center></div>
<div class="col-sm-2"><center><img src="https://i.imgur.com/r2Q4faF.png" width="128px" height="128px" style="border-radius: 50%;" alt="Sigfox Wisol modem - IoT LPWAN Node 868 MHz" title="Sigfox Wisol modem - IoT LPWAN Node 868 MHz"><br><b>Sigfox WISOL SFM10R1</b></center></div>
</div>
<hr>
<center> 
	<h2>Supported and tested ultrasonic sensors for measuring water level in well</h2>
</center>	
     <hr>				
<div class="row">
<div class="col-sm-2"><center><img src="https://i.imgur.com/t4HDpjA.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ultrasonic distance sensor HC-SR04 - Arduino / ESP8266 / ESP32" title="Ultrasonic distance sensor HC-SR04 - Arduino / ESP8266 / ESP32"><br><b>HC-SR04</b></center></div>
<div class="col-sm-2"><center><img src="https://i.imgur.com/WXWD0wt.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ultrasonic distance sensor HC-SR05" title="Ultrasonic distance sensor HC-SR05"><br><b>HC-SR05</b></center></div>
<div class="col-sm-2"><center><img src="https://i.imgur.com/DlWRbhK.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ultrasonic distance sensor JSN-SR04T - Arduino / ESP8266 / ESP32" title="Ultrasonic distance sensor JSN-SR04T - Arduino / ESP8266 / ESP32"><br><b>JSN-SR04T</b></center></div>		
<div class="col-sm-2"><center><img src="https://i.imgur.com/MuTRnZu.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ultrasonic distance sensor HY-SRF05 - Arduino / ESP8266 / ESP32" title="Ultrasonic distance sensor HY-SRF05 - Arduino / ESP8266 / ESP32"><br><b>HY-SRF05</b></center></div>
<div class="col-sm-2"><center><img src="https://i.imgur.com/R51S6y5.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ultrasonic distance sensor HY-SRF06 - Arduino / ESP8266 / ESP32" title="Ultrasonic distance sensor HY-SRF06 - Arduino / ESP8266 / ESP32"><br><b>HY-SRF06</b></center></div>
<div class="col-sm-2"><center><img src="https://i.imgur.com/8Dogp3S.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ultrasonic distance sensor DYP-ME007 - Arduino / ESP8266 / ESP32" title="Ultrasonic distance sensor DYP-ME007 - Arduino / ESP8266 / ESP32"><br><b>DYP-ME007</b></center></div>
<!---
<div class="col-sm-3"><center><img src="https://i.imgur.com/P4HvyLn.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ultrazvukový senzor vzdialenosti URM07 ovládaný cez UART" title="Ultrazvukový senzor vzdialenosti URM07 ovládaný cez UART"><br><b>URM07</b></center></div>	
--->
</div>					
<hr>
<center> 
	<h2> Level meter - Arduino / ESP8266 / ESP32 </h2> 
</center> 
<hr>
<p style ="text-align: justify;">
The level meter project (water level monitor) consists of a central web interface, which is used to visualize the measured data on the water level in real time, but also historically in time through a tabular / graphical representation of line graphs.
The web interface is responsive, it can adapt to any screen and device resolution.
The data can be read on watches, smartphones, computers, smart TVs and other devices.
The web interface of the project uses a backend written in PHP, which can process incoming data from the HTTP POST method request.
It then corrects the measured level to the actual one based on the known depth of the well.
It also calculates the well volume for a given measurement based on the known well diameter.
The depth and diameter of the well are entered into the system by the user based on his well.
The data is sent to a web server by a microcontroller, which performs measurements every 300 seconds - i. For 5 minutes, or in the case of transmission via the Sigfox IoT network, the data is sent every 11 minutes.
<b> Water level measurement is performed using ultrasonic sensors </b> - HC-SR04, or its waterproof variant JSN-SR04T, or UART sensor URM07 (SKU SEN0153) - available only in a special version of the project Level meter. It can measure a distance of up to 750 cm, due to the large detection angle, it does not fit into a large number of wells ...
The principle of measuring ultrasonic sensors is to send a Trigger signal with a length of 10μs (microseconds) and based on the time when the signal returns to the receiver - Echo it is possible to calculate the distance between the sensor and the level.
An important parameter in both ultrasonic sensors is the beam width, in other words the detection characteristic.
The HC-SR04 sensor has a 15 ° detection characteristic. The beam is relatively narrow and the sensor is also suitable for narrower wells and tanks, but it is not waterproof and has a high risk of corrosion (oxidation).
For this reason, it is advisable to place it above the well.
The JSN-SR04T waterproof sensor has a detection characteristic of 60 to 75 °, which does not allow it to be used in narrow wells, as the beam expands greatly with distance and a well with a diameter of several units (6 meters at 4.5 well depth) is required.
Ultrasonic measurement is suitable for measuring the level of drinking, utility and waste water.
The system and ultrasonic sensors are maintenance-free.
Just plug in, upload the software implementation and run.
Ultrasonic sensors can also be used to measure the height of the material in various applications.
In the case of a square well, the diameter is the diameter of the inscribed circle, which will form the reference value of the water cylinder and the volume of the well.
The maximum measurable level height (level) by the sensors is approx. 400 to 450 cm (known from the datasheet).
</p>
<hr><center><h4>Video demonstration of the web interface - Water Level monitor:</h4></center><hr>
<center><iframe width="75%" height="315" src="https://www.youtube.com/embed/RBksATd0-60" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></center>
<hr><center><h4>Ultrasonic sensors are suitable for:</h4></center><hr>
<li> Digged wells </li>
<li> Septics and cesspools </li>
<li> Plastic rainwater tanks </li>
<li> Trays </li>
<hr><center><h4>Ultrasonic sensors are <font color="red">NOT</font> suitable for:</h4></center><hr>
<li> Drilled wells </li>
<li> Pipes and tubes </li>
<li> Wells with unstable water level </li>
<hr><center><h3>Principle of level meter operation - Block diagram</h3></center><hr>
<center><img src="https://i.imgur.com/VCobc6h.jpg" style="display: block; max-width: 100%; height: auto;" alt="Level meter for cesspool, septic tank, well, measuring principle - ultrasonic distance sensor" title="Level meter for cesspool, septic tank, well, measuring principle - ultrasonic distance sensor"></center>
<p style="text-align: justify;">
The web interface uses trigonometry to estimate the measurable maximum depth of the well at a known well diameter (another parameter for calculating the well volume).
The web interface allows the user to calculate to what maximum depth of the well each of the sensors is suitable based on its characteristics.
The project is so easy to use even for laymen who do not know which sensor is more suitable for application in their well.
The microcontroller used also plays an important role in the system. The project used the Arduino platform (Uno) connected to an Ethernet module / shield from the Wiznet model W5100 and W5500 series, respectively, which provided HTTP connectivity and enabled the microcontroller to transfer data to a remote web interface on the Internet.
As the level meter is an outdoor project, many users would also like the possibility of using a WiFi platform without having to pull Ethernet connectivity to the well.
WiFi platforms from Espressif Systems - ESP8266 and ESP32, which are used in the project, allow operation in various modes - StandBy, Deep Sleep (deep sleep with WiFi modem turned off), StandBy + OTA - allows you to remotely upload to the board new firmware directly from the board Arduino IDE environment.
On request, it is also possible to create a Remote OTA update, which is distributed remotely via the Internet from a web server, you can use the Github repository, which can distribute the update to the client in RAW format .bin.
For the Deep Sleep operating mode, there is a modified wiring diagram for the ESP8266 platform, which uses a signal that is fed to the RST to wake up the WAKE microcontroller.
At the same time, this connection does not allow the program to be updated without disconnecting this jumper.
For ESP32, Deep Sleep mode is used using an RTC timer, which wakes up ESP after a certain time.
Platforms can communicate with the web interface via HTTP, but also HTTPS protocol. The ESP8266 platform uses a fingeprint of the web server's public key in SHA1 format, but requires more frequent renewals, as they are valid for a maximum of one year or 2 years, respectively.
The microcontroller from the ESP32 series uses the certificate of the root certification authority, which issued the certificate for the web server - the ROOT CA certificate in .pem format for the HTTPS connection.
From the point of view of operation, this option is better, as the certificate of the certification authority is also valid for 20 years and no renewal of the certificate is necessary.
The project can be integrated via MQTT into home automation (Hassio, Domoticz, Loxone) to display the water level in its own dashboard.
Possibility of offline measurements (completely without connectivity) with a report on the UART interface, character LCD displays 16x2 / 20x4 communicating via I2C bus.
</p>
<hr>
<div class = "alert alert-info">
<strong> Program implementations for Arduino, ESP8266, ESP32: </strong> <a href="http://arduino.clanweb.eu/studna_s_prekladom/program.php?lang=en"> HERE </a>
</div>
<hr>
<p style = "text-align: justify;">
For locations where there is no coverage of the fixed Internet, it is also possible to use the IoT network Sigfox, which covers almost 90% of Slovakia, has broadcasting stations mainly on Towercome transmitters.
This technology allows you to transmit small volumes of messages up to 12B in size. In the case of the Level meter project, the 4B water level value is sent. For a project extended by a rain gauge, the value 8B value is sent, which is formed by the height of the water level and the increase in precipitation.
As Sigfox allows a maximum of 140 messages to be transmitted per day, the data transmission interval is extended to 11 minutes. In both cases, the message does not contain the full length that it can, i. 12B.
Payload messages can also be supplemented with various system information, for example: GEO data (longitude / latitude), RSSI (Signal Strength), message number and others.
The communication module that was used for the project is a Sigfox WISOL 868MHz UART modem. This modem communicates via AT commands via the UART interface, which is software emulated on microcontrollers.
The communication will take over at a speed of 9600 baud / s. The WISOL modem is equipped with an integrated u.FL connector on the PCB module for antenna connection, which significantly reduces coverage even indoors / shaded outdoors.
For successful data transmission, coverage by two, preferably three or more BTS stations is required for successful data transmission. The BTS sends the transmitted information to the Sigfox backend, where it is necessary to make a callback, which will start after receiving the data.
The callback must make an HTTP or HTTPS request to the domain where the web application is running with the POST method and a suitably encoded payload that the web application backend expects.
</p>
<div class="alert alert-success">
<b>Level meter - Callback settings in Sigfox Backend:</b>
<li>Callbacks --> Custom --> New</li>
<li><b>In Custom payload config we write:</b> cislo1::uint:16</li>
<li><b>To URL pattern:</b> http://arduino.clanweb.eu/studna_s_prekladom/data.php (or another URL of your web server where the project will run), the possibility to use HTTPS</li>
<li><b>In the HTTP method, select:</b> POST</li>
<li><b>To the Body (body of the message) we add:</b></li>
<li>hodnota={customData#cislo1}</li>
<li><b>To Content-Type:</b> application/x-www-form-urlencoded</li>
</div>			
<hr>
<center> 
     <h3>Screenshots of Water Level monitor webapp</h3>
     <hr>
	<a href="http://arduino.clanweb.eu/studna_s_prekladom/?lang=en">
	<img src="https://i.imgur.com/JnxXFzC.gif" style="display: block; max-width: 100%; height: auto;" alt="Water Level Monitor webapp with automatic refresh of measurement value" title="Water Level Monitor webapp with automatic refresh of measurement value">
    	<img src="https://i.imgur.com/y3hNRIf.png" style="display: block; max-width: 100%; height: auto;" alt="WaterWell Level monitor - webapp - main page - Last measured values with automatic refresh - AJAX" title="WaterWell Level monitor - webapp - main page - Last measured values with automatic refresh - AJAX">
    	<img src="https://i.imgur.com/rkFWcWv.png" style="display: block; max-width: 100%; height: auto;" alt="WaterWell Level monitor - webapp - Historical measured datas with timestamp" title="WaterWell Level monitor - webapp - Historical measured datas with timestamp"> 
	<img src="https://i.imgur.com/FqqGV8o.png" style="display: block; max-width: 100%; height: auto;" alt="WaterWell Level monitor - Record, minimal, maximal value per day, week, month" title="WaterWell Level monitor - Record, minimal, maximal value per day, week, month"> 
	<img src="https://i.imgur.com/lutb8T8.png" style="display: block; max-width: 100%; height: auto;" alt="WaterWell Level monitor - graph of water level in time - week / year" title="WaterWell Level monitor - graph of water level in time - week / year"> 
	</a>
		</center>			
	<center> 
     <h4>Detection characteristics of the HC-SR04 sensor - 15° beam width</h4>
     <hr>
<a href="http://arduino.clanweb.eu/studna_s_prekladom/?lang=en">
    <img src="https://i.imgur.com/ySEAjWi.png" style="display: block; max-width: 100%; height: auto;" alt="Waterwell monitor - Detection characteristics of the HC-SR04 sensor - 15° beam width" title="Waterwell monitor  - Detection characteristics of the HC-SR04 sensor - 15° beam width">
</a>   
 <hr>
     <h4>Detection characteristics of the JSN-SR04T sensor - waterproof - 45° beam width</h4>
     <hr>
<a href="http://arduino.clanweb.eu/studna_s_prekladom/?lang=en">
    <img src="https://i.imgur.com/qCSLUjw.png" style="display: block; max-width: 100%; height: auto;" alt="Waterwell monitor  - Detection characteristics of the JSN-SR04T sensor - waterproof - 45° beam width" title="Waterwell monitor  - Detection characteristics of the JSN-SR04T sensor - waterproof - 45° beam width"> 
</a>
 </center>		
 </div>
		</div>
</div>
</body>
</html>
