<!DOCTYPE html>
<html>
<head>
</head>
<body>
    <div id="result"></div>

    <script>
        fetch('/.netlify/functions/netlify-function')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.text();
            })
            .then(data => {
                // Process the data from the serverless function
                const jsonStartIndex = data.indexOf('{'); // Assuming JSON starts somewhere in the HTML
                if (jsonStartIndex !== -1) {
                    const jsonData = JSON.parse(data.substring(jsonStartIndex));
                    console.log(jsonData);
                    document.getElementById('result').textContent = JSON.stringify(jsonData);
                } else {
                    console.error('JSON data not found in the response.');
                }
            })
            .catch(error => {
                console.error(error);
            });
    </script>

    <script>
        // Netlify Function code here
        async function fetchData() {
            try {
                const apiUrl = 'https://arduino.clanweb.eu/studna_s_prekladom/json_output.php';
                const response = await fetch(apiUrl);
                const data = await response.text();
                return data;
            } catch (error) {
                return { error: 'Failed to fetch data' };
            }
        }

        const handler = async (event, context) => {
            const data = await fetchData();
            return {
                statusCode: 200,
                body: data,
            };
        };
    </script>
</body>
</html>
