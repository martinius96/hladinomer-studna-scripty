// Inicializácia QR scanneru
let scanner = new Instascan.Scanner({ video: document.getElementById('qr-video') });

scanner.addListener('scan', function (content) {
    document.getElementById('qr-result').textContent = content;
    fetchTableData(content);
});

Instascan.Camera.getCameras().then(function (cameras) {
    if (cameras.length > 0) {
        scanner.start(cameras[1]);
    } else {
        console.error('No cameras found.');
    }
}).catch(function (e) {
    console.error(e);
});

// Načítanie údajov z URL a zobrazenie tabuľky
function fetchTableData(url) {
    let xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);

    xhr.onload = function () {
        if (xhr.status >= 200 && xhr.status < 300) {
            let tableData = parseTable(xhr.responseText);
            displayTable(tableData);
        } else {
            console.error('Error loading data from URL');
        }
    };

    xhr.send();
}

// Analýza tabuľky z HTML
function parseTable(html) {
    let parser = new DOMParser();
    let doc = parser.parseFromString(html, 'text/html');
    let table = doc.querySelector('table');
    if (!table) {
        return [];
    }

    let data = [];
    let rows = table.querySelectorAll('tr');
    for (let i = 0; i < rows.length; i++) {
        let row = rows[i];
        let columns = row.querySelectorAll('td');
        let rowData = [];
        for (let j = 0; j < columns.length; j++) {
            rowData.push(columns[j].textContent);
        }
        data.push(rowData);
    }

    return data;
}

// Zobrazenie tabuľky používateľovi
function displayTable(data) {
    let tableDataDiv = document.getElementById('table-data');
    tableDataDiv.innerHTML = ''; // Vyprázdni predchádzajúci obsah

    let table = document.createElement('table');
    for (let i = 0; i < data.length; i++) {
        let row = table.insertRow(i);
        for (let j = 0; j < data[i].length; j++) {
            let cell = row.insertCell(j);
            cell.textContent = data[i][j];
        }
    }

    tableDataDiv.appendChild(table);
}
