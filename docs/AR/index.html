<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>QR Scanner - Water level monitor</title>
    <script type="text/javascript">
        window.smartlook||(function(d) {
            var o=smartlook=function(){ o.api.push(arguments)},h=d.getElementsByTagName('head')[0];
            var c=d.createElement('script');o.api=new Array();c.async=true;c.type='text/javascript';
            c.charset='utf-8';c.src='https://rec.smartlook.com/recorder.js';h.appendChild(c);
        })(document);
        smartlook('init', 'db50efe9fff280a17db52b82be221240cbbd3dbe');
    </script>    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <style>
        /* Your existing CSS styles remain unchanged */
    </style>
</head>
<body style="margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh;">
    <!-- Add camera selection buttons here -->
    <div id="camera-buttons"></div>

    <video id="qr-video" style="width: 100%; height: auto;" autoplay></video>
    <canvas id="qr-canvas" style="display: none;"></canvas>
    <div id="qr-result" style="margin-top: 20px;"></div>
    <!-- New div to show the table -->
    <div id="table-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; align-items: center; justify-content: center; background-color: rgba(0, 0, 0, 0.7); z-index: 999;">
        <!-- Your table code remains unchanged -->
    </div>

    <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
    <script>
        let scanner;
        let isTableVisible = false;

function updateScanner(cameraIndex) {
    Instascan.Camera.getCameras().then(function (cameras) {
        if (cameras.length > 0) {
            if (scanner) {
                scanner.stop(); // Stop the current scanner
            }

            // Remove existing video element
            const videoElement = document.getElementById('qr-video');
            videoElement.parentNode.removeChild(videoElement);

            // Create a new video element
            const newVideoElement = document.createElement('video');
            newVideoElement.id = 'qr-video';
            newVideoElement.style = 'width: 100%; height: auto;';
            document.body.appendChild(newVideoElement);

            // Recreate the scanner with the new video element
            scanner = new Instascan.Scanner({ video: newVideoElement, mirror: false });
            scanner.addListener('scan', function (content) {
                // Your existing scan event listener code
            });
            scanner.start(cameras[cameraIndex]);
        } else {
            console.error('No cameras found.');
        }
    }).catch(function (e) {
        console.error('Error accessing camera: ' + e);
    });
}

        // Function to show the table overlay
        function showTableOverlay() {
            const overlay = document.getElementById('table-overlay');
            overlay.style.display = 'flex';
        }

        // Function to hide the table overlay
        function hideTableOverlay() {
            const overlay = document.getElementById('table-overlay');
            overlay.style.display = 'none';
        }

        // Function to load JSON data and update the table
        function loadJSONData() {
            // Your existing code for loading JSON data
        }

        // Function to initialize the scanner
        function initScanner() {
            Instascan.Camera.getCameras().then(function (cameras) {
                if (cameras.length > 0) {
                    scanner = new Instascan.Scanner({ video: document.getElementById('qr-video'), mirror: false });
                    scanner.addListener('scan', function (content) {
                        // Your existing scan event listener code
                    });
                    scanner.start(cameras[0]);
                    // Create buttons for each camera
                    const cameraButtons = document.getElementById('camera-buttons');
                    cameras.forEach((camera, index) => {
                        const button = document.createElement('button');
                        button.className = 'btn btn-secondary';
                        button.textContent = `Camera ${index + 1}`;
                        button.addEventListener('click', function () {
                            updateScanner(index);
                        });
                        cameraButtons.appendChild(button);
                    });
                } else {
                    console.error('No cameras found.');
                }
            }).catch(function (e) {
                console.error('Error accessing camera: ' + e);
            });
        }

        // Call the function to initialize the scanner
        initScanner();
        
        // Your existing code for resumeScanning, refreshData, and loadJSONData
    </script>
</body>
</html>
