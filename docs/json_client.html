<!DOCTYPE html>
<html lang="sk-SK">
<head>
	<!-- Primary Meta Tags -->
	<title>JSON klient pre Hladinomer: MQTT Publish, ArduinoJson, deserializácia, parsovanie dát (Arduino, ESP32)</title>
	<meta name="description" content="JSON klient pre Arduino, ESP8266 a ESP32 pre projekt Hladinomer: Parsovanie dát a Publish na MQTT službu IoT Industries Slovakia">
	<meta name="keywords" content="JSON, Arduino, Ethernet, WiFi, ESP8266, ESP32, parsing, ArduinoJson, deserialization, MQTT, publish, subscribe, dáta, prenos, HTTP, MQTTS, šifrované, socket, IoT, Industries, Slovakia, Hladinomer, water, waterwell, hladina, monitor, litre">
	<meta name="news_keywords" content="json, arduino, ethernet, wifi, esp8266, esp32, parsing, arduinojson, deserialization, mqtt, publish, subscribe, dáta, prenos, http, mqtts, šifrovane, socket, iot, industries, slovakia, Hladinomer, water, waterwell, hladina, monitor, litre">	
<!-- Open Graph / Facebook -->
	<meta name="robots" content="index, follow">
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://martinius96.github.io/hladinomer-studna-scripty/json_client.html">
	<meta property="og:title" content="JSON klient pre Hladinomer: MQTT Publish, ArduinoJson, deserializácia, parsovanie dát (Arduino, ESP32)">
	<meta property="og:description" content="JSON klient pre Arduino, ESP8266 a ESP32 pre projekt Hladinomer: Parsovanie dát a Publish na MQTT službu IoT Industries Slovakia">
	<meta property="og:image" content="">

<!-- Twitter -->
	<meta property="twitter:card" content="summary_large_image">
	<meta property="twitter:url" content="https://martinius96.github.io/hladinomer-studna-scripty/json_client.html">
	<meta property="twitter:title" content="JSON klient pre Hladinomer: MQTT Publish, ArduinoJson, deserializácia, parsovanie dát (Arduino, ESP32)">
	<meta property="twitter:description" content="JSON klient na platforme Arduino, ESP866, ESP32 pre projekt Hladinomer. Umožňujú parsovanie dát, Publish na MQTT službu IoT Industries Slovakia">
	<meta property="twitter:image" content="">
	
	<link rel="icon" type="image/png" href="https://martinius96.github.io/termostat-ethernet/favicon.png">
	<link rel="sitemap" type="application/xml" title="Sitemap" href="../sitemap.xml" />
	<meta name="google-site-verification" content="UwZZh2EXv3iWUAi_1Z0hLxVCz6ySJ4UdY_BPoLtejwo" />    	
	<meta property='fb:admins' content='100001242570317'>
    	<meta charset="utf-8">
    	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	<script type="text/javascript">
    		window.smartlook||(function(d) {
    			var o=smartlook=function(){ o.api.push(arguments)},h=d.getElementsByTagName('head')[0];
    			var c=d.createElement('script');o.api=new Array();c.async=true;c.type='text/javascript';
    			c.charset='utf-8';c.src='https://rec.smartlook.com/recorder.js';h.appendChild(c);
    		})(document);
    		smartlook('init', 'db50efe9fff280a17db52b82be221240cbbd3dbe');
	</script>    
	<style>
		table, th, td {
  			border: 1px solid black;
		}
	</style>
</head>
<body>
	<div class="container">
  		<div class="row">
    			<div class="col-sm-12">
<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <ul class="nav navbar-nav">
      	<li><a href="index.html">Hladinomer</a></li>
	<li><a href="zapojenie.html">Zapojenie</a></li>   
	<li class="active"><a href="json_client.html">JSON client</a></li>   
      	<li><a href="kontakt.html">Kontakt</a></li>
	    <li><a href="QR/index.html">QR skener</a></li>
	<a href="en/json_client.html"><img src="https://i2.wp.com/facsusa.com/wp-content/uploads/2017/05/Flag-of-England.png?ssl=1" alt="English.png, 2,2kB" title="English" height="32" width="32"></a>
<a href="fr/json_client.html"><img src="https://i.imgur.com/vX7NaZ7.png" alt="French.png, 2,2kB" title="French" height="32" width="32"></a> 
<a href="de/json_client.html"><img src="https://i.imgur.com/kY5DFH5.png" alt="German.png, 2,2kB" title="German" height="32" width="32"></a>
<a href="ro/json_client.html"><img src="https://i.imgur.com/yCHCmMZ.png" alt="Romanian.png, 2,2kB" title="Romanian" height="32" width="32"></a>
<a href="da/json_client.html"><img src="https://i.imgur.com/BOi815w.png" alt="Danish.png, 2,2kB" title="Danish" height="32" width="32"></a>
<a href="fi/json_client.html"><img src="https://i.imgur.com/dDFaJqs.png" alt="Finnish.png, 2,2kB" title="Finnish" height="32" width="32"></a>
<a href="pl/json_client.html"><img src="https://i.imgur.com/OteBe4t.png" alt="Polish.png, 2,2kB" title="Polish" height="32" width="32"></a>
<a href="ru/json_client.html"><img src="https://i.imgur.com/3R5jVrX.png" alt="Russian.png, 2,2kB" title="Russian" height="32" width="32"></a>
</ul>
  </div>
</nav>  
<div class="alert alert-success">
					<strong>Repozitár projektu Hladinomer so zdrojovými kódmi pre JSON klientov - Github: </strong><a href="https://github.com/martinius96/hladinomer-studna-scripty/">Hladinomer</a>
				</div>	
<span class="label label-default">Arduino</span>
<span class="label label-primary">Ethernet</span>
<span class="label label-success">Wiznet W5100 / W5500</span>
<span class="label label-info">ESP8266</span>
<span class="label label-warning">ESP32</span>
<span class="label label-danger">Ultrazvuk</span>
<span class="label label-default">HC-SR04</span>
<span class="label label-primary">JSN-SR04T</span>
<span class="label label-info">LoRaWAN</span>	
<span class="label label-warning">JSON</span>
<span class="label label-danger">MQTT</span>
<div class="row">
  <div class="col-sm-3"><center><img src="https://i.imgur.com/X946pmi.png" width="128px" height="128px" style="border-radius: 50%;" alt="JSON DATA" title="JSON DATA"><br><b>JSON DATA</b></center></div>
  <div class="col-sm-3"><center><img src="https://i.imgur.com/B2xdel0.png" width="128px" height="128px" alt="ArduinoJSON" title="ArduinoJSON"><br><b>ArduinoJSON</b></center></div>
  <div class="col-sm-3"><center><img src="https://i.imgur.com/oXhOEZi.png" width="128px" height="128px" style="border-radius: 50%;" alt="MQTT" title="MQTT"><br><b>MQTT</b></center></div>
  <div class="col-sm-3"><center><img src="https://i.imgur.com/WWpufkP.png" width="128px" height="128px" style="border-radius: 50%;" alt="HTTP" title="HTTP"><br><b>HTTP</b></center></div>
</div>	
<hr><center><h2>JSON klienti - Hladinomer</h2></center><hr>
<p style="text-align: justify;">
Arduino, ESP8266 a ESP32 platformy umožňujú pripojenie k webovému serveru (Hladinomera) pomocou JSON klienta cez WebSocket. 
Klient pravidelne vykonáva HTTP GET request každých 60 sekúnd na získanie obsahu podstránky: <a href="http://arduino.clanweb.eu/studna_s_prekladom/json_output.php">/json_output.php</a>. Webserver distribuuje dáta vo formáte JSON o výške hladiny vody (v centimetroch) a objeme studne (v litroch) na základe aktuálne nastavenej hĺbky a priemere studne. 
JSON klient pravidelne vykonáva HTTP GET request každých 60 sekúnd na získanie obsahu podstránky, kde sa tieto údaje nachádzajú.
Načítaný JSON payload je schopný klient vyparsovať z HTTP response a deserializovať. Po deserializácii je možné pristupovať k jednotlivým kľúčom a získať hodnoty. Tieto vyparsované dáta sú následne vypísané na UART (sériová linka) s rýchlosťou 115200 baud/s.
V používateľskej aplikácii, ktorá môže byť doplnená do existujúcich zdrojových kódov JSON klientov, je možné ovládať rôzne entity na základe získaných hodnôt. Napríklad automatizovaná závlaha po dosiahnutí určitej výšky hladiny vody, prečerpávanie vody alebo spustenie čerpadla.
Súčasťou firmvéru označeného ako MQTT, resp. MQTTS (šifrované MQTT), je rozšírený JSON klient, ktorý umožňuje odosielanie (publishovanie) dát na MQTT Broker IoT Industries Slovakia, slovenský bezplatný MQTT Broker určený pre vývojárov. MQTT a MQTTS variant využívajú socket, rovnaký ako pre HTTP request na získanie JSON payloadu.
Existujúci MQTT server môže byť v zdrojových kódoch nahradený vaším vlastným, čím sa umožní integrácia dát z hladinomera do systémov domácej automatizácie, ako sú Hassio, Mosquitto MQTT, Domoticz, Loxone a ďalšie. V aktuálnej programovej implementácii mikrokontrolér (JSON klient) odosiela získané dáta na MQTT Broker do topicu hladinomer, pričom jednotlivé teploty sú odlíšené v subtopicoch.
</p> 
<div class="alert alert-success">
	<strong>Ukážkové programové implementácie pre JSON klientov: </strong><a href="https://github.com/martinius96/hladinomer-studna-scripty/tree/master/examples/JSON_Hladinomer">TU</a>
</div>
<hr><center><h4>Dostupné knižnice pre mikrokontroléry (Arduino / ESP) - JSON klienti</h4></center><hr>
<div class="alert alert-danger">
	Archív knižnice (.zip) rozbaliť do <strong>C:/Používatelia/[Používateľ]/Dokumenty/Arduino/libraries</strong>
</div>
<div class="table-responsive">   
<table class="table" style="border: 1px solid black;">
<thead>
<tr>
<th style="width: 25%">Názov knižnice</th>
<th style="width: 50%">Funkcia knižnice</th>
<th style="width: 25%">Stiahnuť</th>
</tr>
</thead>
<tbody>
<tr>
<td style="width: 25%"><b>PubSubClient</b></td>
<td style="width: 50%">
<p style="text-align: justify;">
Knižnica pre AVR mikrokontroléry (ATmega) Arduino Uno / Nano / Mega, ESP8266 a ESP32. 
Umožňuje komunikovať po MQTT protokole, možno implementovať aj šifrované spojenie s MQTT Brokerom, vyžaduje sa použitie WiFiClientSecure triedy u ESP mikrokontrolérov. 
</p>
</td>
<td style="width: 25%"><a href="https://download-directory.github.io/?url=https%3A%2F%2Fgithub.com%2Fmartinius96%2Fhladinomer-studna-scripty%2Ftree%2Fmaster%2Fsrc%2FPubSubClient" class="btn btn-success" role="button">Stiahnuť</a></td>
</tr>
<tr>
<td style="width: 25%"><b>ArduinoJson</b></td>
<td style="width: 50%">
<p style="text-align: justify;">
Knižnica pre AVR mikrokontroléry (ATmega) Arduino Uno / Nano / Mega, ESP8266 a ESP32. 
Umožňuje deserializovať reťazec v JSON štruktúre, dokáže vyparsovať hodnotu, ktorá je priradená ku kľúču. 
</p>
</td>
<td style="width: 25%"><a href="https://download-directory.github.io/?url=https%3A%2F%2Fgithub.com%2Fmartinius96%2Fhladinomer-studna-scripty%2Ftree%2Fmaster%2Fsrc%2FArduinoJson" class="btn btn-success" role="button">Stiahnuť</a></td>
</tr>
</tbody>
</table>
	</div>
<div class="alert alert-info">
<strong>Implementácia pre MQTTS je k dispozícii pre mikrokontroléry ESP8266 a ESP32.</strong> Oba mikrokontroléry využívajú Root CA certifikát na zabezpečené pripojenie k MQTT serveru. <b>Šifrovaný port MQTT servera je štandardne nastavený na 8883, zatiaľ čo nešifrovaný port je 1883.</b>
Pre získanie Root CA certifikátu pre konkrétny MQTT server (doménu) môžete využiť nástroj OpenSSL, ktorý jednoducho umožňuje načítať a zobraziť príslušné informácie.
Jednotlivé certifikáty sú vypísané v poradí Chain-of-Trust, teda od Root CA po Intermediate.
<br><b>Príkaz pre získanie Root CA certifikátu, ktorý vydal certifikát pre MQTT server (Issuer):</b><br>
<code>openssl s_client -showcerts -verify 5 -connect mqttserver.com:8883 < /dev/null</code>
</div>
<h4><font color="#C0392B">Ukážkový výpis dát vo formáte JSON</font></h4>
<div class="alert alert-danger">
	{<br>
		"value": 378,<br>
		"volume": 1900.04<br>
	}
</div>
<hr>
<h4>Používané topicy pre Publish na MQTT Broker sú:</h4> 
<hr>
<li><b>hladinomer/objem</b> - pre objem studne v litroch</li>
<li><b>hladinomer/vyska</b> - pre aktuálnu výšku hladiny vody v centimetroch</li>
<hr>
<h4>Topic pre Subscribe:</h4>
<hr>
<li><b>hladinomer/#</b> - odoberá všetky subtopicy pod hladinomer/, teda objem, výšku</li>
<p style="text-align: justify;">
<b>MQTT klient je prihlásený na Subscribe hlavného topicu hladinomer a všetkých jeho subtopikov. Zároveň schopnosťou klienta je overiť úspešnú publikáciu informácie na MQTT Brokeri a následne ju spätne vypísať na UART.</b>
<b><font color="red">UPOZORNENIE: MQTT Broker IoT Industries Slovakia, použitý vo vzorovej implementácii, je verejný a dáta môžu byť zmenené, prepísané alebo čítané akýmkoľvek používateľom!</font></b>
Pri nahrávaní firmvéru JSON klienta do mikrokontroléru bez akejkoľvek zmeny môže iný používateľ prepisovať vaše dáta v preddefinovanom topiku a rovnako aj vy jemu.
Vlastná implementácia by mala zvoliť iný topik pre odosielanie dát s cieľom zabrániť nechcenému prepisovaniu.
</p>
<hr>    
<h4>JSON PHP výstup, parsing a Publish na MQTT Broker:</h4>
<hr>
<center><img src="https://i.imgur.com/vZu48Mc.png" style="display: block; max-width: 100%; height: auto;" alt="JSON client (Arduino, ESP8266, ESP32) pre Hladiomer - UART výstup" title="JSON client (Arduino, ESP8266, ESP32) pre Hladiomer - UART výstup"></center>       		
<h4>HiveMQ client - Subscribe topicu hladinomer/#</h4>
<center><img src="https://i.imgur.com/WS9gThO.png" style="display: block; max-width: 100%; height: auto;" alt="JSON client MQTT Broker IoT Industries Slovakia - výstup topicu - Subscribe termostat" title="JSON client MQTT Broker IoT Industries Slovakia - výstup topicu - Subscribe termostat"></center> 
					</div>
</div>
</div>
</body>
</html>
